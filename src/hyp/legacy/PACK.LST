Turbo Assembler	 Version 4.0	    02/01/95 23:46:08	    Page 1
pack.ASM



      1				     ; File Pack.Asm
      2				     Include Defs.Inc
1     3				     ;File Defs.Inc
1     4
1     5						Ideal
1     6						Jumps
1     7	0000					Model Large, Pascal
1     8
1     9	      =2000		     bitpufferlaenge = 8192
1    10	      =1FFF		     StrIndBufLen  = 8191
1    11	      =09C4		     UnComprSize = 2500
1    12
1    13				     Macro fillword _offset,w,anzahl	;  for i:=0 to anzahl-1	do
1    14									;    (ES:_offset)[i]:=w
1    15						   Cld
1    16						   Mov Ax,w
1    17						   Mov Cx,anzahl
1    18						   Mov Di,_Offset
1    19						   rep stosw
1    20				     EndM
1    21
1    22				     Macro EDHeader PName
1    23				     Proc PName	Far aReader: QWord, aWriter: QWord, aSeg1: Word, aSeg2:	Word
1    24				     Public PName
1    25				       Assume Ds: DGroup, Es: Nothing
1    26				       Mov Es,[aSeg1]
1    27				       Mov [Es:CallersDS],Ds
1    28				       Mov Es,[aSeg2]
1    29				       Mov Ds,[aSeg1] ;	aDataSeg
1    30				       Assume Ds: aDataSeg
1    31
1    32				       Mov Ax,[Word aReader]
1    33				       Mov [Word Reader], Ax
1    34				       Mov Ax,[Word aReader+2]
1    35				       Mov [Word Reader+2],Ax
1    36				       Mov Ax,[Word aReader+4]
1    37				       Mov [Word Reader+4],Ax
1    38				       Mov Ax,[Word aReader+6]
1    39				       Mov [Word Reader+6],Ax
1    40				       Mov Ax,[Word aWriter]
1    41				       Mov [Word Writer], Ax
1    42				       Mov Ax,[Word aWriter+2]
1    43				       Mov [Word Writer+2],Ax
1    44				       Mov Ax,[Word aWriter+4]
1    45				       Mov [Word Writer+4],Ax
1    46				       Mov Ax,[Word aWriter+6]
1    47				       Mov [Word Writer+6],Ax
1    48				     EndM
1    49
1    50	0000			     Segment aDataSeg Private Para
1    51	0000  1FFF*(????)	       StrIndBuf	 DW StrIndBufLen DUP (?)
1    52
1    53	3FFE  ????		       bbytepos		 DW ?
1    54	4000  ????		       bitpos		 DW ?
1    55	4002  2002*(??)		       bitpuffer	 DB bitpufferlaenge+2 DUP (?)
1    56
1    57	*004			       UNION tSharedUnion      ; maken eine Typ	fr eine šberlagerung...
Turbo Assembler	 Version 4.0	    02/01/95 23:46:08	    Page 2
pack.ASM



1    58					 ;  Huffman-Parameter
1    59	      =0C80			 huffsize    = 3200
1    60					 ;	       ^^^^ >= StrIndBufLen div	(maxfreq+1)+1+(maxdiff-mindiff+1)+(maxfreq+1)
1    61	*000				 Struc
1    62	*000  01*(1901*(????))		   Vater     DW	2*huffsize+1 DUP (?)
1    63	*202  01*(1901*(????))		   Sohn	     DW	2*huffsize+1 DUP (?)
1    64	*404  01*(1901*(????))		   TheFreq   DW	2*huffsize+1 DUP (?)
1    65	*606				 EndS
1    66	*000				 Struc
1    67	*000  01*(1FFF*(????))		   HashPos   DW	StrIndBufLen DUP (?)
1    68	*FFE  01*(1FFF*(????))		   newindex  DW	StrIndBufLen DUP (?)
1    69	*FFC				 EndS
1    70	*606			       EndS tSharedUnion
1    71	6004  9606*(??)		       Shared tSharedUnion <>
1    72
1    73	F60A  ????		       CallersDS dw ?		 ; Datensegment	des Aufrufer's
1    74				       ; alle Variablen	ins DatenSegment verlagert
1    75				       ; (wg. Windows und sauberer Programmierung)
1    76				     ;	modus		  DW ?
1    77	F60C  ????		       max_bitpufpos	 DW ?
1    78	F60E  ????		       TestStrings_Index DW ?
1    79	F610  ????		       Low_tsi		 DW ?
1    80	F612  09C4*(??)		       UnComprData	 Db UnComprSize	Dup (?)
1    81	FFD6  ????		       UnComprPtr	 Dw ?  ; pointer to UnComprData	(nur bei read)
1    82	FFD8  ????		       UnComprEnd	 Dw ?  ; pointer to end	of UnComprData (bei read und write)
1    83				       ; --- huffman
1    84	FFDA  ????		       HuffMax	     dw	?
1    85	FFDC  ????		       lastposition  dw	?
1    86	FFDE  ????		       maxlocal	     dw	?
1    87	FFE0  ????		       maxlocal255   dw	?		       ; maxlocal+2*255
1    88	FFE2  ????		       local_offset  dw	?		       ; diff_offset+(maxdiff-mindiff+1)
1    89	FFE4  ????		       pos_offset    dw	?		       ; local_offset+(maxlocal+1)
1    90	FFE6  ????		       char_offset   dw	?		       ; pos_offset+(maxfreq+1)
1    91
1    92	FFE8  ???????? ????????	       Reader	 dd ?,?		 ; Leseroutine des Aufrufer's
1    93	FFF0  ???????? ????????	       Writer	 dd ?,?		 ; Leseroutine des Aufrufer's
1    94	FFF8			     EndS aDataSeg
1    95
1    96				     ;---- hashing
1    97	      =0001		     free	 = 1			     ;	Markierung freier Eintr„ge in der Hash-Tabelle
1    98
1    99	      =4000		     maxhash = 16384	;*** 16384
1   100
1   101	0000			     Segment HashSeg Private Para
1   102	0000  4000*(????)	       hasharray     DW	maxhash	DUP (?)
1   103	8000  1FFF*(????)	       hashvalue     DW	StrIndBufLen DUP (?)
1   104	BFFE  1FFF*(????)	       rehashvalue   DW	StrIndBufLen DUP (?)
1   105	FFFC			     EndS HashSeg
1   106
1   107				     ;------------------- Huffman
1   108				     ;
1   109	      =-0004		     mindiff	     = -4
1   110	      =0008		     maxdiff	     = 8
1   111	      =0002		     maxfreq	     = 2
1   112	      =0000		     lsequence_key   = 0
1   113	      =0001		     diff_offset     = 1		     ;	reserve	 1 Char	for sequences
1   114
Turbo Assembler	 Version 4.0	    02/01/95 23:46:08	    Page 3
pack.ASM



1   115	      =1000		     maxrecfrequency = 4096		     ;	Huffman	will be	updated	up to this frequency
1   116	      =20C7		     tabsize	     = StrIndBufLen+200;
1   117				     ;				    ^^^	 >= 1+(maxdiff-mindiff+1)+(maxfreq+1)
1   118
1   119	0000			     Segment TheHuffES Private Para
1   120				       ;  Index-Tabelle
1   121	0000  2000*(????)	       nindex	  DW StrIndBufLen+1 DUP	(?)
1   122	4000  20C8*(????)	       nvalue	  DW tabsize+1	      DUP (?)
1   123	8190  20C8*(????)	       frequencys DW tabsize+1	      DUP (?)
1   124
1   125				       ;  Freq-Array
1   126	C320  03*(????)		       nfreq	     DW	maxfreq+1	 DUP (?)
1   127	C326  ????		       HuffMaxindex DW ?
1   128
1   129				       ;  Teil des dynamischen Huffman
1   130	C328  1000*(????)	       nfreqmax	  DW maxrecfrequency  DUP (?)
1   131	E328			     EndS TheHuffES
1   132
1   133				     Macro DebugBreak
1   134				     ifdef Debug
1   135				       Int 3
1   136				     endif
1   137				     EndM
1   138
1   139
    140
    141	0000			     CodeSeg
    142
    143				     EDHeader Encode
1   144	0000			     Proc Encode Far aReader: QWord, aWriter: QWord, aSeg1: Word, aSeg2: Word
1   145				     Public Encode
1   146				       Assume Ds: DGroup, Es: Nothing
2   147	0000  55			     PUSH    BP
2   148	0001  8B EC			     MOV     BP,SP
2   149	0003  8E 46 08		       Mov Es,[aSeg1]
1   150	0006  26: 8C 1E	F60A	       Mov [Es:CallersDS],Ds
1   151	000B  8E 46 06		       Mov Es,[aSeg2]
1   152	000E  8E 5E 08		       Mov Ds,[aSeg1] ;	aDataSeg
1   153				       Assume Ds: aDataSeg
1   154
1   155	0011  8B 46 12		       Mov Ax,[Word aReader]
1   156	0014  A3 FFE8		       Mov [Word Reader], Ax
1   157	0017  8B 46 14		       Mov Ax,[Word aReader+2]
1   158	001A  A3 FFEA		       Mov [Word Reader+2],Ax
1   159	001D  8B 46 16		       Mov Ax,[Word aReader+4]
1   160	0020  A3 FFEC		       Mov [Word Reader+4],Ax
1   161	0023  8B 46 18		       Mov Ax,[Word aReader+6]
1   162	0026  A3 FFEE		       Mov [Word Reader+6],Ax
1   163	0029  8B 46 0A		       Mov Ax,[Word aWriter]
1   164	002C  A3 FFF0		       Mov [Word Writer], Ax
1   165	002F  8B 46 0C		       Mov Ax,[Word aWriter+2]
1   166	0032  A3 FFF2		       Mov [Word Writer+2],Ax
1   167	0035  8B 46 0E		       Mov Ax,[Word aWriter+4]
1   168	0038  A3 FFF4		       Mov [Word Writer+4],Ax
1   169	003B  8B 46 10		       Mov Ax,[Word aWriter+6]
1   170	003E  A3 FFF6		       Mov [Word Writer+6],Ax
    171	0041  C7 06 FFD6 F612			  Mov [UnComprPtr],Offset UnComprData
Turbo Assembler	 Version 4.0	    02/01/95 23:46:08	    Page 4
pack.ASM



    172	0047  C7 06 FFD8 F612			  Mov [UnComprEnd],Offset UnComprData
    173
    174	004D  C7 06 3FFE 4002			  Mov [bbytepos],Offset	bitpuffer	 ;  bbytepos:=0
    175	0053  C7 06 4000 0008			  Mov [bitpos],0008h			 ;  bitpos:=8
    176	0059  C7 06 F610 01FE			  Mov [Low_tsi],2*255			 ;  Low_tsi:=255
    177
    178	005F  E8 0058		     @@repeat:	  Call FindDuplicates
    179	0062  E8 02E7				  Call WriteSmart
    180	0065  E8 0000e				  Call ClearWhenFull
    181	0068  81 3E F60E 00FF			  Cmp [teststrings_index],255
    182	006E  75 EF				  Jne @@repeat
    183
    184	0070  8B 0E 4000			  Mov Cx,[bitpos]
    185	0074  80 F9 08				  Cmp Cl,8
    186	0077  74 0B 90 90 90			  Je @@1
    187	007C  B9 0008				  Mov Cx,8
    188	007F  33 DB				  Xor Bx,Bx
    189	0081  E8 0254				  Call wBits			   ; 8 Nullbits	schreiben
    190	0084  E8 0008		     @@1:	  Call WriteCompressedData
    191	0087  8E 1E F60A			  Mov Ds,[CallersDS]
1   192	008B  5D			     POP     BP
1   193	008C  CA 0014			     RET     00014h
    194	008F			     EndP Encode
    195
    196				     Assume Ds:	aDataSeg
    197
    198				     Macro ReadUnCompressedData
    199					     Push Ax Bx	Cx Dx Si Di Es Ds
    200					     Mov Ax,Offset UnComprData
    201					     Mov Bx,UnComprSize
    202					     Mov Dx,Ds
    203					     Mov Es,Dx
    204					     Mov Di, Offset Reader
    205					     Mov Ds,[CallersDS]
    206					     Call [DWord Es:Di]	Pascal,	Dx, Ax,	Bx, [Word Es:Di+6], [Word Es:Di+4]
    207					     Pop Ds
    208					     Add Ax,Offset UnComprData
    209					     Mov [UnComprEnd],Ax
    210					     Mov [UnComprPtr],Offset UnComprData
    211					     Pop Es Di Si Dx Cx	Bx Ax
    212				     EndM
    213
    214	008F			     Proc WriteCompressedData Near
    215	008F  50 53 51 52 56 57	06+	     Push Ax Bx	Cx Dx Si Di Es Ds
    216	      1E
    217	0097  B8 4002			     Mov Ax,Offset bitpuffer
    218	009A  8B 1E 3FFE		     Mov Bx,[bbytepos]
    219	009E  2B D8			     Sub Bx,Ax
    220	00A0  8C DA			     Mov Dx,Ds
    221	00A2  8E C2			     Mov Es,Dx
    222	00A4  BF FFF0			     Mov Di, Offset Writer
    223	00A7  8E 1E F60A		     Mov Ds,[CallersDS]
    224					     Call [DWord Es:Di]	Pascal,	Dx, Ax,	Bx
1   225	00AB  52			     PUSH    DX
1   226	00AC  50			     PUSH    AX
1   227	00AD  53			     PUSH    BX
1   228	00AE  26: FF 1D			     CALL    [DWORD ES:DI]
Turbo Assembler	 Version 4.0	    02/01/95 23:46:08	    Page 5
pack.ASM



    229	00B1  1F 07 5F 5E 5A 59	5B+	     Pop Ds Es Di Si Dx	Cx Bx Ax
    230	      58
1   231	00B9  C3			     RET     00000h
    232	00BA			     EndP WriteCompressedData
    233
    234				     Assume Es:	HashSeg
    235
    236				     Macro calc_hashval	LabArg
    237									    ;  (hv,Cx)=hashfun(Ax,Dx)
    238									    ;  (HashValue,reHashValue)[Di]:=(hv,Cx)
    239						  Mov Bx,Ax		  ;    hashval[Di]:=  hashval[Ax]+  hashval[Dx]
    240						  Mov Cx,[reHashValue+Bx];  rehashval[Di]:=rehashval[Ax]ñrehashval[Dx]
    241						  Mov  Si,[HashValue+Bx]
    242						  Mov Bx,Dx
    243						  Add  Si,[HashValue+Bx]
    244						  test Cx,1H
    245						  Mov Bx,[reHashValue+Bx]
    246						  je LabArg
    247						  neg Bx
    248				     LabArg:	  Add Cx,Bx
    249						  Mov [HashValue+Di], Si
    250						  Mov [reHashValue+Di],Cx
    251				     EndM
    252
    253				     Macro HashInit
    254				     Local @@loop, @@riloop, @@for, @@endfor, @@repeat
    255						  fillword <Offset HashArray>,free,maxhash
    256				     ; Initialisierung der Hash-Werte #0..#255
    257						  Mov bx,31415
    258						  Mov cx,256
    259						  Mov ax,1
    260						  Xor Di,Di
    261				     @@loop:	  mul bx
    262						  Mov [HashValue+Di],ax
    263						  Add Di,2
    264						  loop @@loop
    265						  Mov [HashValue+2*256],0
    266
    267				     ; Initialisierung der ReHash-Werte	#0..#255
    268						  Mov bx,27183
    269						  Mov cx,256
    270						  Mov ax,1
    271						  Mov Di,2*255
    272
    273				     @@riloop:	  Mul Bx
    274						  Mov [reHashValue+Di],ax
    275						  Sub Di,2
    276						  loop @@riloop
    277
    278						  Mov [reHashValue+2*256],0
    279
    280				     ;	Positionen StrIndBuf[255]..StrIndBuf[Low_tsi-1]
    281				     ;	in die Hash-Tabelle aufnehmen
    282						  Mov Di,2*255
    283						  Mov [Word Ptr	StrIndBuf+Di-2],0
    284						  Mov Ax,[StrIndBuf+Di]		;  Ax:=StrIndBuf[255]
    285				     @@for:	  Add Di,2		    ;  for i:=256 to Low_tsi-1 do
Turbo Assembler	 Version 4.0	    02/01/95 23:46:08	    Page 6
pack.ASM



    286						  Cmp Di,[Low_tsi]
    287						  jae @@endfor
    288						  Mov Dx,[StrIndBuf+Di]		;      Dx:=StrIndBuf[i]
    289						  calc_hashval LabelX
    290						  Mov Ax,Dx
    291
    292						  Or Cx,2		   ; first hash	==> ggT(Cx,2)=1
    293				     @@repeat:	  Add Si,Cx		       ; repeat	hv=(hv+Cx) mod maxhash
    294						  and Si,2*(maxhash-1)		;   (lineares Re-Hashing)
    295						  Cmp [HashArray+Si],free
    296						  jne @@repeat			; until	(Bx=HashArray[hv])==free
    297
    298						  Mov [Di+Shared.HashPos],Si	       ;      Shared.HashPos[Di]:=HashValue
    299						  Mov [HashArray+Si],Di		;      HashArray[HashValue]:=Di
    300						  Jmp @@for
    301				     @@endfor:
    302				     EndM
    303
    304	00BA			     Proc FindDuplicates Near
    305						  HashInit
1   306						  fillword <Offset HashArray>,free,maxhash
2   307									;    (ES:_offset)[i]:=w
2   308	00BA  FC				   Cld
2   309	00BB  B8 0001				   Mov Ax,free
2   310	00BE  B9 4000				   Mov Cx,maxhash
2   311	00C1  BF 0000				   Mov Di,Offset HashArray
2   312	00C4  F3> AB				   rep stosw
1   313				     ; Initialisierung der Hash-Werte #0..#255
1   314	00C6  BB 7AB7				  Mov bx,31415
1   315	00C9  B9 0100				  Mov cx,256
1   316	00CC  B8 0001				  Mov ax,1
1   317	00CF  33 FF				  Xor Di,Di
1   318	00D1  F7 E3		     @@0000:	  mul bx
1   319	00D3  26: 89 85	8000			  Mov [HashValue+Di],ax
1   320	00D8  83 C7 02				  Add Di,2
1   321	00DB  E2 F4				  loop @@0000
1   322	00DD  26: C7 06	8200 0000		  Mov [HashValue+2*256],0
1   323
1   324				     ; Initialisierung der ReHash-Werte	#0..#255
1   325	00E4  BB 6A2F				  Mov bx,27183
1   326	00E7  B9 0100				  Mov cx,256
1   327	00EA  B8 0001				  Mov ax,1
1   328	00ED  BF 01FE				  Mov Di,2*255
1   329
1   330	00F0  F7 E3		     @@0001:	Mul Bx
1   331	00F2  26: 89 85	BFFE			  Mov [reHashValue+Di],ax
1   332	00F7  83 EF 02				  Sub Di,2
1   333	00FA  E2 F4				  loop @@0001
1   334
1   335	00FC  26: C7 06	C1FE 0000		  Mov [reHashValue+2*256],0
1   336
1   337				     ;	Positionen StrIndBuf[255]..StrIndBuf[Low_tsi-1]
1   338				     ;	in die Hash-Tabelle aufnehmen
1   339	0103  BF 01FE				  Mov Di,2*255
1   340	0106  C7 45 FE 0000			  Mov [Word Ptr	StrIndBuf+Di-2],0
1   341	010B  8B 05				  Mov Ax,[StrIndBuf+Di]		;  Ax:=StrIndBuf[255]
1   342	010D  83 C7 02		     @@0002:	   Add Di,2		     ;	for i:=256 to Low_tsi-1	do
Turbo Assembler	 Version 4.0	    02/01/95 23:46:08	    Page 7
pack.ASM



1   343	0110  3B 3E F610			  Cmp Di,[Low_tsi]
1   344	0114  73 4E 90 90 90			  jae @@0003
1   345	0119  8B 15				  Mov Dx,[StrIndBuf+Di]		;      Dx:=StrIndBuf[i]
1   346						  calc_hashval LabelX
2   347									    ;  (hv,Cx)=hashfun(Ax,Dx)
2   348									    ;  (HashValue,reHashValue)[Di]:=(hv,Cx)
2   349	011B  8B D8				  Mov Bx,Ax		  ;    hashval[Di]:=  hashval[Ax]+  hashval[Dx]
2   350	011D  26: 8B 8F	BFFE			  Mov Cx,[reHashValue+Bx];  rehashval[Di]:=rehashval[Ax]ñrehashval[Dx]
2   351	0122  26: 8B B7	8000			  Mov  Si,[HashValue+Bx]
2   352	0127  8B DA				  Mov Bx,Dx
2   353	0129  26: 03 B7	8000			  Add  Si,[HashValue+Bx]
2   354	012E  F7 C1 0001			  test Cx,1H
2   355	0132  26: 8B 9F	BFFE			  Mov Bx,[reHashValue+Bx]
2   356	0137  74 05 90 90 90			  je LabelX
2   357	013C  F7 DB				  neg Bx
2   358	013E  03 CB		     LabelX:	  Add Cx,Bx
2   359	0140  26: 89 B5	8000			  Mov [HashValue+Di], Si
2   360	0145  26: 89 8D	BFFE			  Mov [reHashValue+Di],Cx
1   361	014A  8B C2				  Mov Ax,Dx
1   362
1   363	014C  83 C9 02				  Or Cx,2		   ; first hash	==> ggT(Cx,2)=1
1   364	014F  03 F1		     @@0004:	Add Si,Cx		     ; repeat hv=(hv+Cx) mod maxhash
1   365	0151  81 E6 7FFE			  and Si,2*(maxhash-1)		;   (lineares Re-Hashing)
1   366	0155  26: 83 3C	01			  Cmp [HashArray+Si],free
1   367	0159  75 F4				  jne @@0004		      ;	until (Bx=HashArray[hv])==free
1   368
1   369	015B  89 B5 6004			  Mov [Di+Shared.HashPos],Si	       ;      Shared.HashPos[Di]:=HashValue
1   370	015F  26: 89 3C				  Mov [HashArray+Si],Di		;      HashArray[HashValue]:=Di
1   371	0162  EB A9				  Jmp @@0002
1   372	0164			     @@0003:
    373	0164  8B 3E F610			  Mov Di,[Low_tsi]
    374	0168  8B 45 FE				  Mov Ax,[StrIndBuf+Di-2]
    375
    376	016B  81 FF 3FFE	     WhileLoop:	  Cmp Di,2*StrIndBufLen	   ; while Di<StrIndBufLen do
    377	016F  73 56 90 90 90			  Jae @@Return
    378	0174  8B 36 FFD6			  Mov Si,[UnComprPtr]
    379	0178  3B 36 FFD8			  Cmp Si,[UnComprEnd]
    380	017C  75 54 90 90 90			  Jne @@2
    381						  ReadUnCompressedData
1   382	0181  50 53 51 52 56 57	06+	     Push Ax Bx	Cx Dx Si Di Es Ds
    383	      1E
1   384	0189  B8 F612			     Mov Ax,Offset UnComprData
1   385	018C  BB 09C4			     Mov Bx,UnComprSize
1   386	018F  8C DA			     Mov Dx,Ds
1   387	0191  8E C2			     Mov Es,Dx
1   388	0193  BF FFE8			     Mov Di, Offset Reader
1   389	0196  8E 1E F60A		     Mov Ds,[CallersDS]
1   390					     Call [DWord Es:Di]	Pascal,	Dx, Ax,	Bx, [Word Es:Di+6], [Word Es:Di+4]
2   391	019A  52			     PUSH    DX
2   392	019B  50			     PUSH    AX
2   393	019C  53			     PUSH    BX
2   394	019D  26: FF 75	06		     PUSH    [WORD ES:DI+6]
2   395	01A1  26: FF 75	04		     PUSH    [WORD ES:DI+4]
2   396	01A5  26: FF 1D			     CALL    [DWORD ES:DI]
1   397	01A8  1F			     Pop Ds
1   398	01A9  05 F612			     Add Ax,Offset UnComprData
1   399	01AC  A3 FFD8			     Mov [UnComprEnd],Ax
Turbo Assembler	 Version 4.0	    02/01/95 23:46:08	    Page 8
pack.ASM



1   400	01AF  C7 06 FFD6 F612		     Mov [UnComprPtr],Offset UnComprData
1   401	01B5  07 5F 5E 5A 59 5B	58	     Pop Es Di Si Dx Cx	Bx Ax
    402	01BC  81 3E FFD8 F612			  Cmp [UnComprEnd],Offset UnComprData
    403	01C2  75 0A 90 90 90			  Jne @@1
    404	01C7  D1 EF		     @@Return:	  Shr Di,1		   ; eof
    405	01C9  89 3E F60E			  Mov [teststrings_index],Di
1   406	01CD  C3			     RET     00000h
    407	01CE  8B 36 FFD6	     @@1:	  Mov Si,[UnComprPtr]
    408	01D2  33 D2		     @@2:	  Xor Dx,Dx
    409	01D4  8A 14				  Mov Dl,[Si]
    410	01D6  FF 06 FFD6			  Inc [UnComprPtr]
    411	01DA  D1 E2				  Shl Dx,1
    412
    413	01DC			     @@loop:	  calc_hashval LabelY
1   414									    ;  (hv,Cx)=hashfun(Ax,Dx)
1   415									    ;  (HashValue,reHashValue)[Di]:=(hv,Cx)
1   416	01DC  8B D8				  Mov Bx,Ax		  ;    hashval[Di]:=  hashval[Ax]+  hashval[Dx]
1   417	01DE  26: 8B 8F	BFFE			  Mov Cx,[reHashValue+Bx];  rehashval[Di]:=rehashval[Ax]ñrehashval[Dx]
1   418	01E3  26: 8B B7	8000			  Mov  Si,[HashValue+Bx]
1   419	01E8  8B DA				  Mov Bx,Dx
1   420	01EA  26: 03 B7	8000			  Add  Si,[HashValue+Bx]
1   421	01EF  F7 C1 0001			  test Cx,1H
1   422	01F3  26: 8B 9F	BFFE			  Mov Bx,[reHashValue+Bx]
1   423	01F8  74 05 90 90 90			  je LabelY
1   424	01FD  F7 DB				  neg Bx
1   425	01FF  03 CB		     LabelY:	  Add Cx,Bx
1   426	0201  26: 89 B5	8000			  Mov [HashValue+Di], Si
1   427	0206  26: 89 8D	BFFE			  Mov [reHashValue+Di],Cx
    428
    429	020B  83 C9 02				  Or Cx,2		   ; first hash	==> ggT(Cx,2)=1
    430
    431				     ; --- Vereinfachen
    432				     ;	     loop (hi,Bx)=hashindex(Ax,Dx)
    433				     ;		  if isfree(HashArray[hi]) then	goto do_pos
    434	020E  03 F1		     @@hrepeat:	  Add Si,Cx		    ; loop (hv,Cx)=rehash(hv,Cx)
    435	0210  81 E6 7FFE			  and Si,2*(maxhash-1)	     ;	 (lineares Re-Hashing)
    436	0214  26: 8B 1C				  Mov Bx,[HashArray+Si]
    437	0217  83 FB 01				  Cmp Bx,free
    438	021A  75 03 E9 009F			  je @@do_pos		     ;	     exitif (_pos=HashArray[hv])==free
    439	021F  3B 3E F610			  Cmp Di,[Low_tsi]
    440	0223  75 03 E9 0096			  je @@do_pos
    441
    442	0228  3B 47 FE				  Cmp Ax,[StrIndBuf+Bx-2]
    443	022B  75 1D 90 90 90			  jne @@test2
    444	0230  8B 2F				  Mov bp,[StrIndBuf+Bx]
    445	0232  3B DD				  Cmp Bx,bp
    446	0234  74 0D 90 90 90			  je @@square
    447	0239  3B D5				  Cmp Dx,bp
    448	023B  74 5D 90 90 90			  je @@sende
    449	0240  EB 08 90				  Jmp @@test2
    450	0243  3B D0		     @@square:	  Cmp Dx,Ax
    451	0245  74 53 90 90 90			  je @@sende		     ;	     exitif (Ax,Dx)=decode(Bx)
    452
    453	024A  3D 0200		     @@test2:	  Cmp Ax,2*256
    454	024D  72 BF				  jb @@hrepeat		     ;	     continue if Ax<256
    455
    456	024F  8B 6F FE				  Mov bp,[StrIndBuf+Bx-2]
Turbo Assembler	 Version 4.0	    02/01/95 23:46:08	    Page 9
pack.ASM



    457	0252  96				  Xchg si,Ax
    458	0253  3B 6C FE				  Cmp bp,[StrIndBuf+si-2]
    459	0256  96				  Xchg si,Ax
    460	0257  75 B5				  jne @@hrepeat		     ;	     continue if StrIndBuf[Ax-1]<>StrIndBuf[Bx-1]
    461
    462	0259  8B EB				  Mov bp,Bx
    463	025B  3B 1F				  Cmp Bx,[StrIndBuf+Bx]	 ; Bx:=	secondpart(Bx)
    464	025D  74 06 90 90 90			  je @@x1
    465	0262  83 C3 02				  Add Bx,2
    466	0265  8B 5F FE		     @@x1:	  Mov Bx,[StrIndBuf+Bx-2]
    467	0268  81 FB 0200			  Cmp Bx,2*256		   ;	   continue if Bx<256
    468	026C  72 A0				  jb @@hrepeat
    469
    470	026E  56				  push si
    471	026F  8B F0				  Mov si,Ax
    472	0271  3B 34				  Cmp si,[StrIndBuf+si]	 ; si:=	secondpart(si)
    473	0273  74 06 90 90 90			  je @@x2
    474	0278  83 C6 02				  Add si,2
    475	027B  8B 74 FE		     @@x2:	  Mov si,[StrIndBuf+si-2]
    476	027E  3B 77 FE				  Cmp si,[StrIndBuf+Bx-2]
    477	0281  5E				  pop si
    478	0282  75 8A				  jne @@hrepeat		     ;	     continue if secondpart(Ax)<>StrIndBuf[Bx-1]
    479	0284  3B 1F				  Cmp Bx,[StrIndBuf+Bx]	 ; Bx:=	secondpart(Bx)
    480	0286  74 06 90 90 90			  je @@x3
    481	028B  83 C3 02				  Add Bx,2
    482	028E  8B 5F FE		     @@x3:	  Mov Bx,[StrIndBuf+Bx-2]
    483	0291  3B D3				  Cmp Dx,Bx
    484	0293  74 03 E9 FF76			  jne @@hrepeat		     ;	     continue if Dx<>secondpart(Bx)
    485									     ;	endloop
    486	0298  8B DD				  Mov Bx,bp
    487	029A			     @@sende:
    488	029A  3B 3E F610			  Cmp Di,[Low_tsi]
    489	029E  74 2E 90 90 90			  je @@no_match
    490
    491	02A3  8B D3				  Mov Dx,Bx		   ;		Dx:=Bx
    492	02A5  83 EF 02				  Sub Di,2		     ;		  dec(Di)
    493
    494	02A8  3B D7				  Cmp Dx,Di
    495	02AA  74 22 90 90 90			  je @@no_match
    496
    497	02AF  8B 45 FE				  Mov Ax,[StrIndBuf+Di-2]	 ;	      Ax:=StrIndBuf[Di-1]
    498	02B2  8B 9D 6004			  Mov Bx,[Di+Shared.HashPos]   ;	    HashArray[Shared.HashPos[Di]]:=free
    499	02B6  26: C7 07	0001			  Mov [HashArray+Bx],free
    500	02BB  E9 FF1E				  Jmp @@loop			 ;	 endloop
    501
    502				     ; --- Ende	vereinfachen
    503
    504	02BE  81 FF 01FE	     @@do_pos:	  Cmp Di,2*255
    505	02C2  74 0A 90 90 90			  je @@no_match
    506	02C7  89 B5 6004			  Mov [Di+Shared.HashPos],Si		;  do_pos: Shared.HashPos[Di]:=HashValue
    507	02CB  26: 89 3C				  Mov [HashArray+Si],Di		 ;	 HashArray[HashValue]:=Di
    508
    509	02CE  8B C2		     @@no_match:  Mov Ax,Dx		     ;	     StrIndBuf[Di]:=Ax:=Dx
    510	02D0  89 05				  Mov [StrIndBuf+Di],Ax
    511	02D2  83 C7 02				  Add Di,2		     ;	     inc(Di)
    512	02D5  E9 FE93				  Jmp WhileLoop
    513	02D8			     EndP FindDuplicates
Turbo Assembler	 Version 4.0	    02/01/95 23:46:08	    Page 10
pack.ASM



    514
    515
    516				     ;--- Huffman
    517				     ;
    518				     Assume Ds:	aDataSeg, Es: TheHuffES
    519
    520				     EXTRN ClearWhenFull: Near
    521				     EXTRN set_vars: Near
    522				     EXTRN InitHuffTables: Near
    523				     EXTRN inc_frequency: Near
    524				     EXTRN inc_posfreq:	Near
    525
    526				     Macro wBit	BitBuf,	BitCnt,	ByteCnt
    527				     Local Done
    528				     ; write out bit in	Carry
    529				       Rcr BitBuf,1				 ;; shift bit in carry
    530				       Dec BitCnt
    531				       Jne Done					 ;; if bitpos>0	Then done
    532				       Mov BitCnt,8				 ;; Else: reset	bitpos
    533				       Mov ByteCnt,[bbytepos]			 ;;
    534				       Mov [ByteCnt],BitBuf			 ;; write byte to buffer
    535				       Inc ByteCnt				 ;; advance and...
    536				       Mov [bbytepos],ByteCnt			 ;; ...update pointer
    537				       Cmp ByteCnt,bitpufferlaenge+Offset bitpuffer ;; check, if write
    538				       Jb Done					 ;; no write yet
    539				       Call WriteCompressedData			 ;; write data out
    540				       Mov [bbytepos],Offset bitpuffer		 ;; reset bbytepos
    541				     Done:
    542				     EndM
    543
    544	02D8			     Proc wBits	   Near			     ; procedure wBits(BX=item,CX=nbits)
    545	02D8  E3 37 90 90 90 90	90		   Jcxz	@@exit		     ; cx=count
    546	02DF  A1 4000				   Mov Ax,[bitpos]	     ;	fOr c:=1 to count do
    547	02E2  D1 EB		     @@for:	   Shr Bx,1		   ;	  schiebe low-Bit von item
    548						   wBit	<Ah>,<Al>,<Di>
1   549				     ; write out bit in	Carry
1   550	02E4  D0 DC		       Rcr Ah,1				     ;
1   551	02E6  FE C8		       Dec Al
1   552	02E8  75 22 90 90 90	       Jne ??0005				   ;
1   553	02ED  B0 08		       Mov Al,8				     ;
1   554	02EF  8B 3E 3FFE	       Mov Di,[bbytepos]		    ;
1   555	02F3  88 25		       Mov [Di],Ah			;
1   556	02F5  47		       Inc Di				    ;
1   557	02F6  89 3E 3FFE	       Mov [bbytepos],Di		    ;
1   558	02FA  81 FF 6002	       Cmp Di,bitpufferlaenge+Offset bitpuffer ;
1   559	02FE  72 0C 90 90 90	       Jb ??0005				   ;
1   560	0303  E8 FD89		       Call WriteCompressedData			 ;
1   561	0306  C7 06 3FFE 4002	       Mov [bbytepos],Offset bitpuffer		 ;
1   562	030C			     ??0005:
    563	030C  E2 D4				   Loop	@@for
    564	030E  A3 4000				   Mov [bitpos],ax
1   565	0311  C3			     RET     00000h
    566	0312			     EndP wBits
    567
    568
    569	0312			     Proc EncodeHuffEntry	near		     ;	procedure EncodeHuffEntry(Value=BX)
    570									     ;	Register: CX: Bits
Turbo Assembler	 Version 4.0	    02/01/95 23:46:08	    Page 11
pack.ASM



    571									     ;		  BX: Value
    572									     ;		  BP: Stack-Position
    573									     ;		  SI,DI
    574	0312  33 C9				   Xor Cx,Cx		     ;	Bits:=0
    575	0314  26: 8B BF	8190			   mov di,[frequencys+Bx]    ;	id:=Frequency(Value)
    576	0319  57				   push	di		     ;	id retten
    577	031A  8B EC				   Mov bp,sp		     ;	Stackposition merken
    578
    579	031C  0B FF		     @@loop:	   Or Di,Di		     ; While id<>0 Do Begin
    580	031E  74 18 90 90 90			   Je @@ende		     ;
    581	0323  8B B5 6004			   Mov Si,[Di+Shared.Vater]  ;	 NextId:= Vater(Id);
    582	0327  39 BC 9206			   Cmp [Si+Shared.Sohn],Di   ;	 If Sohn(Vater(Id))=Id Then
    583	032B  D1 D3				   Rcl Bx,1		     ;	   Value:= Value<1 Else	Value:=	Value<1+1
    584	032D  8B FE				   Mov Di,Si		     ;	 Id:= NextId
    585	032F  41				   Inc Cx		     ;	 Inc(Bits)
    586	0330  80 E1 0F				   And Cl,0Fh		     ;	 Bits:=	Bits Mod 16
    587	0333  75 E7				   Jne @@loop		     ;	 If Bits=0 Then
    588	0335  53				   Push	Bx		     ;	   push(Value)
    589	0336  EB E4				   Jmp @@loop		     ;	End
    590
    591	0338			     @@ende:
    592	0338  E8 FF9D		     @@repeat:	   Call	wBits		     ;	repeat wBits(BX,CX)
    593	033B  3B E5				   Cmp sp,bp
    594	033D  74 09 90 90 90			   Je @@empty
    595	0342  5B				   Pop bx		     ;	       pop BX, CX:=16
    596	0343  B9 0010				   mov cx,16
    597	0346  EB F0				   Jmp @@repeat
    598	0348  5F		     @@empty:	   pop di		     ; inc_frequency(huffindex[item]
    599	0349  E9 0000e				   Jmp inc_frequency	     ; exit
    600	034C			     EndP EncodeHuffEntry
    601
    602
    603				     ;;;=================== Output
    604	034C			     Proc WriteSmart	near
    605	034C  E8 0000e				   Call	set_vars
    606	034F  E8 0000e				   Call	InitHuffTables		  ;  InitHuffTables
    607
    608	0352  B9 000D				   Mov Cx,13		     ; 13 Bits schreiben
    609	0355  8B 1E F60E			   mov bx,[teststrings_index] ;	< 2^13 (=StrIndBufLen)
    610	0359  E8 FF7C				   Call	wBits
    611	035C  D1 26 F60E			   shl [teststrings_index],1
    612	0360  8B 3E F610			   mov Di,[Low_tsi]
    613	0364  83 EF 02				   Sub Di,2		    ;  tsi:=Low_tsi-1
    614	0367  C7 06 FFDC 0200			   mov [lastposition],2*256    ;  lastposition:=256
    615
    616	036D  A1 FFE6				   Mov Ax,[char_offset]
    617	0370  05 01FE				   Add Ax,2*255
    618	0373  26: A3 C320			   mov [nfreq+0],Ax	      ;	 freq[-1]:=char_offset+2*255
    619	0377  83 C7 02		     @@while:	   Add Di,2		    ;  while ++Di<teststrings_index do
    620	037A  3B 3E F60E			   Cmp Di,[teststrings_index]
    621	037E  72 03 E9 0173			   jae @@endwhile
    622	0383  3B 3E FFE0			   Cmp Di,[maxlocal255]
    623	0387  76 11 90 90 90			   jbe @@endcase
    624
    625	038C  8B C7				   mov Ax,Di		    ;  if Di>=maxlocal+2*255
    626	038E  03 06 FFE6			   Add Ax,[char_offset]
    627	0392  2B 06 FFDE			   Sub Ax,[maxlocal]
Turbo Assembler	 Version 4.0	    02/01/95 23:46:08	    Page 12
pack.ASM



    628	0396  26: A3 C320			   mov [nfreq+0],Ax	      ;	 then freq[-1]:=Di+(char_offset-maxlocal)
    629
    630	039A  8B 1D		     @@endcase:	   mov Bx,[StrIndBuf+Di]	;  begin ti:=StrIndBuf[Di]
    631	039C  81 FB 0200			   Cmp Bx,2*256
    632	03A0  73 03 E9 00F2			   jb @@002		     ;	      if ti<256	then enhuff(ti)
    633
    634	03A5  8B C3				   mov Ax,Bx
    635	03A7  2B 06 FFDC			   Sub Ax,[lastposition]
    636	03AB  89 1E FFDC			   mov [lastposition],Bx
    637	03AF  3D 0004				   Cmp Ax,2*2
    638	03B2  74 23 90 90 90			   je @@enc_seq
    639	03B7  3D FFFC				   Cmp Ax,mindiff
    640	03BA  7C 0B 90 90 90			   jl  @@001
    641	03BF  3D 0008				   Cmp Ax,maxdiff
    642	03C2  7F 03 E9 00B5			   jle @@enc_diff
    643
    644	03C7  8B C7		     @@001:	   mov Ax,Di
    645	03C9  2B C3				   Sub Ax,Bx
    646	03CB  3B 06 FFDE			   Cmp Ax,[maxlocal]
    647	03CF  77 03 E9 00B5			   jbe @@enc_local
    648	03D4  E9 00C0				   Jmp @@002
    649
    650	03D7  03 D8		     @@enc_seq:	   Add Bx,Ax
    651	03D9  3B 5D 02				   Cmp Bx,[StrIndBuf+Di+2]
    652	03DC  74 03 E9 009B			   jne @@enc_diff	     ;		   and StrIndBuf[Di+2]=ti+2
    653	03E1  83 C7 02				   Add Di,2
    654	03E4  3B 3E F60E			   Cmp Di,[teststrings_index] ;		    and	++Di<teststrings_index-1
    655	03E8  72 03 E9 008F			   jae @@enc_diff
    656
    657	03ED  57 53				   Push	Di Bx		     ;		   then	enhuff(lsequence_key)
    658	03EF  BB 0000				   mov bx,2*lsequence_key
    659	03F2  E8 FF1D				   Call	EncodeHuffEntry
    660	03F5  5B 5F				   Pop Bx Di
    661
    662	03F7  83 C3 04		     @@seqloop:	   Add Bx,2*2		     ;			loop ac+:=2
    663	03FA  3B 5D 02				   Cmp Bx,[StrIndBuf+Di+2]
    664	03FD  75 42 90 90 90			   jne @@endsloop	     ;			     exitif ac<>StrIndBuf[Di+1]
    665	0402  83 C7 02				   Add Di,2
    666	0405  3B 3E F60E			   Cmp Di,[teststrings_index]
    667	0409  73 36 90 90 90			   jae @@endsloop	     ;			     exitif ++Di>=teststrings_index
    668	040E  57				   Push	Di
    669	040F  F9				   Stc
    670	0410  A1 4000				   Mov Ax,[bitpos]
    671						   wBit	<Ah>,<Al>,<Di>	     ; ein Bit=1 schreiben
1   672				     ; write out bit in	Carry
1   673	0413  D0 DC		       Rcr Ah,1				     ;
1   674	0415  FE C8		       Dec Al
1   675	0417  75 22 90 90 90	       Jne ??0006				   ;
1   676	041C  B0 08		       Mov Al,8				     ;
1   677	041E  8B 3E 3FFE	       Mov Di,[bbytepos]		    ;
1   678	0422  88 25		       Mov [Di],Ah			;
1   679	0424  47		       Inc Di				    ;
1   680	0425  89 3E 3FFE	       Mov [bbytepos],Di		    ;
1   681	0429  81 FF 6002	       Cmp Di,bitpufferlaenge+Offset bitpuffer ;
1   682	042D  72 0C 90 90 90	       Jb ??0006				   ;
1   683	0432  E8 FC5A		       Call WriteCompressedData			 ;
1   684	0435  C7 06 3FFE 4002	       Mov [bbytepos],Offset bitpuffer		 ;
Turbo Assembler	 Version 4.0	    02/01/95 23:46:08	    Page 13
pack.ASM



1   685	043B			     ??0006:
    686	043B  A3 4000				   Mov [bitpos],Ax
    687	043E  5F				   Pop Di
    688	043F  EB B6				   Jmp @@seqloop	     ;			endloop
    689
    690	0441  83 EB 04		     @@endsloop:   Sub Bx,2*2
    691	0444  89 1E FFDC			   mov [lastposition],Bx     ;			lastposition:=ac-2
    692	0448  57				   Push	Di
    693	0449  F8				   Clc
    694	044A  A1 4000				   Mov Ax,[bitpos]
    695						   wBit	<Ah>,<Al>,<Di>	     ; ein Bit=0 schreiben
1   696				     ; write out bit in	Carry
1   697	044D  D0 DC		       Rcr Ah,1				     ;
1   698	044F  FE C8		       Dec Al
1   699	0451  75 22 90 90 90	       Jne ??0007				   ;
1   700	0456  B0 08		       Mov Al,8				     ;
1   701	0458  8B 3E 3FFE	       Mov Di,[bbytepos]		    ;
1   702	045C  88 25		       Mov [Di],Ah			;
1   703	045E  47		       Inc Di				    ;
1   704	045F  89 3E 3FFE	       Mov [bbytepos],Di		    ;
1   705	0463  81 FF 6002	       Cmp Di,bitpufferlaenge+Offset bitpuffer ;
1   706	0467  72 0C 90 90 90	       Jb ??0007				   ;
1   707	046C  E8 FC20		       Call WriteCompressedData			 ;
1   708	046F  C7 06 3FFE 4002	       Mov [bbytepos],Offset bitpuffer		 ;
1   709	0475			     ??0007:
    710	0475  A3 4000				   Mov [bitpos],Ax
    711	0478  5F				   Pop Di
    712	0479  E9 FEFB				   Jmp @@while
    713
    714	047C  57		     @@enc_diff:   Push	Di	      ;		    else enhuff(differenz+(diff_offset-mindiff))
    715	047D  8B D8				   mov bx,Ax
    716	047F  83 C3 06				   Add bx,2*diff_offset-mindiff
    717	0482  E8 FE8D				   Call	EncodeHuffEntry
    718	0485  5F				   Pop Di
    719	0486  E9 FEEE				   Jmp @@while
    720
    721	0489  57		     @@enc_local:  Push	Di
    722	048A  8B D8				   mov bx,Ax
    723	048C  03 1E FFE2			   Add bx,[local_offset]
    724	0490  E8 FE7F				   Call	EncodeHuffEntry
    725	0493  5F				   Pop Di
    726	0494  E9 FEE0				   Jmp @@while
    727
    728	0497  26: 8B 1F		     @@002:	   mov bx,[Bx+nindex]	      ;	       BX:=Indices[ti]
    729	049A  26: 3B 1E	C326			   Cmp bx,[HuffMaxindex]
    730	049F  73 0B 90 90 90			   jae TabEncode
    731
    732	04A4  57				   Push	Di		    ;	     if	BX<=HuffMaxindex
    733	04A5  E8 FE6A				   Call	EncodeHuffEntry		     ;	      then enhuff(BX)
    734	04A8  5F				   Pop Di
    735	04A9  E9 FECB				   Jmp @@while
    736
    737	04AC  57		     TabEncode:	 Push Di
    738	04AD  53				   push	bx
    739	04AE  26: 8B 9F	8190			   mov bx,[frequencys+bx]
    740	04B3  03 1E FFE4			   Add bx,[pos_offset]
    741	04B7  E8 FE58				   Call	EncodeHuffEntry		     ;	      else enhuff(frequence(BX)+pos_offset)
Turbo Assembler	 Version 4.0	    02/01/95 23:46:08	    Page 14
pack.ASM



    742	04BA  5E				   pop si
    743	04BB  26: 8B 9C	8190			   mov bx,[frequencys+si]
    744	04C0  26: 8B 87	C320			   mov ax,[nfreq+bx]
    745	04C5  26: 8B 9F	C322			   mov bx,[nfreq+bx+2]
    746	04CA  F7 DB				   neg bx
    747	04CC  03 C3				   Add ax,bx
    748	04CE  03 DE				   Add bx,si
    749	04D0  D1 E8				   shr ax,1
    750	04D2  D1 EB				   shr bx,1
    751
    752	04D4  BF 0001				   Mov Di,1
    753	04D7  33 C9				   Xor Cx,Cx
    754	04D9  D1 E7		     @@loop:	   Shl Di,1		     ; Di=2^Cx
    755	04DB  41				   Inc Cx
    756	04DC  3B F8				   Cmp Di,Ax
    757	04DE  76 F9				   jbe @@loop		     ; bis 2^Cx>Bx
    758	04E0  D1 EF				   Shr Di,1
    759	04E2  0B FB				   Or Di,Bx
    760	04E4  3B F8				   Cmp Di,Ax
    761	04E6  76 04 90 90 90			   Jbe @@wrt
    762	04EB  49				   Dec Cx		     ;	if item	Or 2^(count-1)>bound
    763									     ;	then dec(count)
    764	04EC  E8 FDE9		     @@wrt:	   Call	wBits
    765	04EF  E8 0000e				   Call	inc_posfreq
    766	04F2  5F				   Pop Di
    767	04F3  E9 FE81				   Jmp @@while
    768
    769	04F6  D1 2E F60E	     @@endwhile:   shr [teststrings_index],1
1   770	04FA  C3			     RET     00000h
    771	04FB			     EndP WriteSmart
    772
    773				     End
Turbo Assembler	 Version 4.0	    02/01/95 23:46:08	    Page 15
Symbol Table




Symbol Name			  Type	 Value

??0005				  Near	 PACK_TEXT:030C
??0006				  Near	 PACK_TEXT:043B
??0007				  Near	 PACK_TEXT:0475
??DATE				  Text	 "02/01/95"
??FILENAME			  Text	 "pack	  "
??TIME				  Text	 "23:46:08"
??VERSION			  Number 0400
@32BIT				  Text	 0
@@0000				  Near	 PACK_TEXT:00D1
@@0001				  Near	 PACK_TEXT:00F0
@@0002				  Near	 PACK_TEXT:010D
@@0003				  Near	 PACK_TEXT:0164
@@0004				  Near	 PACK_TEXT:014F
@@001				  Near	 PACK_TEXT:03C7
@@002				  Near	 PACK_TEXT:0497
@@1				  Near	 PACK_TEXT:0084
@@1				  Near	 PACK_TEXT:01CE
@@2				  Near	 PACK_TEXT:01D2
@@DO_POS			  Near	 PACK_TEXT:02BE
@@EMPTY				  Near	 PACK_TEXT:0348
@@ENC_DIFF			  Near	 PACK_TEXT:047C
@@ENC_LOCAL			  Near	 PACK_TEXT:0489
@@ENC_SEQ			  Near	 PACK_TEXT:03D7
@@ENDCASE			  Near	 PACK_TEXT:039A
@@ENDE				  Near	 PACK_TEXT:0338
@@ENDSLOOP			  Near	 PACK_TEXT:0441
@@ENDWHILE			  Near	 PACK_TEXT:04F6
@@EXIT				  Near	 PACK_TEXT:0311
@@FOR				  Near	 PACK_TEXT:02E2
@@HREPEAT			  Near	 PACK_TEXT:020E
@@LOOP				  Near	 PACK_TEXT:01DC
@@LOOP				  Near	 PACK_TEXT:031C
@@LOOP				  Near	 PACK_TEXT:04D9
@@NO_MATCH			  Near	 PACK_TEXT:02CE
@@REPEAT			  Near	 PACK_TEXT:005F
@@REPEAT			  Near	 PACK_TEXT:0338
@@RETURN			  Near	 PACK_TEXT:01C7
@@SENDE				  Near	 PACK_TEXT:029A
@@SEQLOOP			  Near	 PACK_TEXT:03F7
@@SQUARE			  Near	 PACK_TEXT:0243
@@TEST2				  Near	 PACK_TEXT:024A
@@WHILE				  Near	 PACK_TEXT:0377
@@WRT				  Near	 PACK_TEXT:04EC
@@X1				  Near	 PACK_TEXT:0265
@@X2				  Near	 PACK_TEXT:027B
@@X3				  Near	 PACK_TEXT:028E
@CODE				  Text	 PACK_TEXT
@CODESIZE			  Text	 1
@CPU				  Text	 0101H
@CURSEG				  Text	 PACK_TEXT
@DATA				  Text	 DGROUP
@DATASIZE			  Text	 1
@FILENAME			  Text	 PACK
@INTERFACE			  Text	 04H
Turbo Assembler	 Version 4.0	    02/01/95 23:46:08	    Page 16
Symbol Table



@MODEL				  Text	 5
@STACK				  Text	 DGROUP
@WORDSIZE			  Text	 2
AREADER				  Number [DGROUP:BP+0012]
ASEG1				  Number [DGROUP:BP+0008]
ASEG2				  Number [DGROUP:BP+0006]
AWRITER				  Number [DGROUP:BP+000A]
BBYTEPOS			  Word	 ADATASEG:3FFE
BITPOS				  Word	 ADATASEG:4000
BITPUFFER			  Byte	 ADATASEG:4002
BITPUFFERLAENGE			  Number 2000
CALLERSDS			  Word	 ADATASEG:F60A
CHAR_OFFSET			  Word	 ADATASEG:FFE6
CLEARWHENFULL			  Near	 PACK_TEXT:----	Extern
DIFF_OFFSET			  Number 0001
ENCODE				  Far	 PACK_TEXT:0000
ENCODEHUFFENTRY			  Near	 PACK_TEXT:0312
FINDDUPLICATES			  Near	 PACK_TEXT:00BA
FREE				  Number 0001
FREQUENCYS			  Word	 THEHUFFES:8190
HASHARRAY			  Word	 HASHSEG:0000
HASHVALUE			  Word	 HASHSEG:8000
HUFFMAX				  Word	 ADATASEG:FFDA
HUFFMAXINDEX			  Word	 THEHUFFES:C326
HUFFSIZE			  Number 0C80
INC_FREQUENCY			  Near	 PACK_TEXT:----	Extern
INC_POSFREQ			  Near	 PACK_TEXT:----	Extern
INITHUFFTABLES			  Near	 PACK_TEXT:----	Extern
LABELX				  Near	 PACK_TEXT:013E
LABELY				  Near	 PACK_TEXT:01FF
LASTPOSITION			  Word	 ADATASEG:FFDC
LOCAL_OFFSET			  Word	 ADATASEG:FFE2
LOW_TSI				  Word	 ADATASEG:F610
LSEQUENCE_KEY			  Number 0000
MAXDIFF				  Number 0008
MAXFREQ				  Number 0002
MAXHASH				  Number 4000
MAXLOCAL			  Word	 ADATASEG:FFDE
MAXLOCAL255			  Word	 ADATASEG:FFE0
MAXRECFREQUENCY			  Number 1000
MAX_BITPUFPOS			  Word	 ADATASEG:F60C
MINDIFF				  Number -0004
NFREQ				  Word	 THEHUFFES:C320
NFREQMAX			  Word	 THEHUFFES:C328
NINDEX				  Word	 THEHUFFES:0000
NVALUE				  Word	 THEHUFFES:4000
POS_OFFSET			  Word	 ADATASEG:FFE4
READER				  Dword	 ADATASEG:FFE8
REHASHVALUE			  Word	 HASHSEG:BFFE
SET_VARS			  Near	 PACK_TEXT:----	Extern
SHARED				  Struct ADATASEG:6004 TSHAREDUNION
STRINDBUF			  Word	 ADATASEG:0000
STRINDBUFLEN			  Number 1FFF
TABENCODE			  Near	 PACK_TEXT:04AC
TABSIZE				  Number 20C7
TESTSTRINGS_INDEX		  Word	 ADATASEG:F60E
UNCOMPRDATA			  Byte	 ADATASEG:F612
Turbo Assembler	 Version 4.0	    02/01/95 23:46:08	    Page 17
Symbol Table



UNCOMPREND			  Word	 ADATASEG:FFD8
UNCOMPRPTR			  Word	 ADATASEG:FFD6
UNCOMPRSIZE			  Number 09C4
WBITS				  Near	 PACK_TEXT:02D8
WHILELOOP			  Near	 PACK_TEXT:016B
WRITECOMPRESSEDDATA		  Near	 PACK_TEXT:008F
WRITER				  Dword	 ADATASEG:FFF0
WRITESMART			  Near	 PACK_TEXT:034C

Macro Name

CALC_HASHVAL
DEBUGBREAK
EDHEADER
FILLWORD
HASHINIT
READUNCOMPRESSEDDATA
WBIT

Structure Name			  Type	Offset

TSHAREDUNION
 VATER				  Word	 0000
 SOHN				  Word	 3202
 THEFREQ			  Word	 6404
 HASHPOS			  Word	 0000
 NEWINDEX			  Word	 3FFE

Groups & Segments		  Bit Size Align  Combine Class

ADATASEG			  16  FFF8 Para	  none
DGROUP				  Group
  _DATA				  16  0000 Word	  Public  DATA
HASHSEG				  16  FFFC Para	  none
PACK_TEXT			  16  04FB Word	  Public  CODE
THEHUFFES			  16  E328 Para	  none
